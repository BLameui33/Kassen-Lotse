<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kostenerstattung Psychotherapie beantragen | ¬ß 13 Abs. 3 SGB V | Kassen-Lotse</title>
  <meta name="description" content="Erstellen Sie einen Antrag auf Kostenerstattung f√ºr ambulante Psychotherapie bei der gesetzlichen Krankenkasse (Systemversagen/zu Unrecht abgelehnt) nach ¬ß 13 Abs. 3 SGB V. Mit Dokumentation der Therapeutensuche und PDF-Erzeugung. Kostenlos, ohne Registrierung.">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/logo-lotse-fav.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script defer src="kostenerstattung_psychotherapie_script.js"></script>
  <link rel="stylesheet" href="/css/generator.css">

  <style>
    .protokoll-anzeige-bereich legend { font-size: 1.05em; color:#444; font-weight:600; }
    .protokoll-anzeige-eintrag { background:#f8f9fa; border:1px solid #e9ecef; padding:10px; margin-bottom:8px; border-radius:6px; font-size:.95em; }
    .protokoll-hinweis { font-size:.95em; color:#555; margin-bottom:1rem; background:#eef7ff; padding:8px; border-radius:4px; border-left:3px solid #0070f3; }
  </style>

  <!-- Schema.org (YMYL/Health + Legal) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MedicalWebPage",
    "name": "Kostenerstattungs-Antrag Psychotherapie",
    "description": "Generator f√ºr einen Antrag auf Kostenerstattung f√ºr Psychotherapie nach ¬ß 13 Abs. 3 SGB V inklusive Dokumentation von Kontaktversuchen.",
    "inLanguage": "de",
    "isPartOf": {
      "@type": "WebSite",
      "name": "Kassen-Lotse",
      "url": "https://kassen-lotse.de"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Kassen-Lotse",
      "url": "https://kassen-lotse.de"
    },
    "about": [
      { "@type": "Thing", "name": "Kostenerstattung" },
      { "@type": "Thing", "name": "Psychotherapie" },
      { "@type": "Thing", "name": "SGB V ¬ß 13" }
    ],
    "lastReviewed": "2025-12-23",
    "reviewedBy": { "@type": "Organization", "name": "Kassen-Lotse Redaktion" }
  }
  </script>
</head>

<body>
  <header class="site-header">
    <a href="index.html" class="site-logo">Kassen-Lotse</a>
  </header>

  <div class="page-container">
    <h1>Antrag auf Kostenerstattung Psychotherapie</h1>

    <p class="info-box info">
      Dieses Tool erstellt ein Anschreiben f√ºr einen Antrag auf Kostenerstattung, wenn eine notwendige psychotherapeutische Behandlung nicht rechtzeitig als Kassenleistung verf√ºgbar ist oder die Krankenkasse eine Leistung zu Unrecht abgelehnt hat (¬ß 13 Abs. 3 SGB V). 
      <strong>Wichtig:</strong> Ein Kostenerstattungsanspruch setzt nach ¬ß 13 Abs. 3 SGB V u.a. voraus, dass f√ºr die selbstbeschaffte Leistung bereits Kosten entstanden sind und die Leistung notwendig war. 
      <strong>Wichtig:</strong> Kosten f√ºr selbstbeschaffte Leistungen, die durch einen Psychotherapeuten erbracht werden, sind nur erstattungsf√§hig, sofern dieser die Voraussetzungen des ¬ß 95c erf√ºllt (¬ß 13 Abs. 3 S. 3 SGB V). 
    </p>

    <p class="info-box">
      <strong>Hinweis zum Kostenrisiko:</strong> Bevor eine Behandlung bei einer Privatpraxis startet, sollte die Krankenkasse m√∂glichst schriftlich zur Kosten√ºbernahme aufgefordert werden; ohne Zusage kann ein Kostenrisiko bestehen, weil ¬ß 13 Abs. 3 SGB V an ‚Äûentstandene Kosten‚Äú und weitere Voraussetzungen ankn√ºpft. 
      <strong>Tipp:</strong> Dokumentation der Suche (Kontaktversuche, Wartezeiten, Absagen) erh√∂ht die Nachvollziehbarkeit, ob die Leistung ‚Äûnicht rechtzeitig‚Äú erbracht werden konnte. 
    </p>

    <p class="info-box">
      <strong>Hinweis zur Datenspeicherung:</strong> ‚ÄûSpeichern/Laden‚Äú nutzt den localStorage im Browser (ger√§t-/browserbezogen); eine automatische √úbermittlung Ihrer Formulardaten an Kassen-Lotse erfolgt dadurch nicht.
    </p>

    <p class="info-box" style="background-color:#fff8e1; border-left:4px solid #ff9800; padding:10px; margin-top:10px;">
      <strong>Wichtiger Hinweis:</strong> Unsere Inhalte/Formulare ersetzen keine Rechtsberatung und keine medizinische Beratung.
      F√ºr verbindliche Einsch√§tzungen (z.B. Dringlichkeit/Indikation, Vorgehen bei Ablehnung) wenden Sie sich bitte an eine Beratungsstelle oder anwaltliche Hilfe.
    </p>

    <p class="highlight-box" style="background-color:#fff3f3; border-left:4px solid #e53935; padding:10px; margin-top:10px;">
      <strong>Technischer Hinweis:</strong> Um das PDF erfolgreich herunterzuladen, √∂ffnen Sie diese Seite bitte in einem Internet-Browser wie <strong>Chrome, Firefox oder Safari</strong>. In der Google-App funktioniert der Download nicht zuverl√§ssig.
    </p>

    <div class="highlight-box pruefdatum-box" role="note" aria-label="Redaktionell gepr√ºft">
      <p><strong>Redaktionell gepr√ºft:</strong> <span id="pruefdatum">23.12.2025</span></p>
    </div>

    <form id="antragForm" autocomplete="on">
      <fieldset>
        <legend>Pers√∂nliche Angaben</legend>

        <label for="name">Vor- und Nachname:</label>
        <input type="text" id="name" name="name" required autocomplete="name">

        <label for="adresse">Ihre vollst√§ndige Adresse: <small>(Stra√üe, Hausnummer, PLZ, Ort)</small></label>
        <textarea id="adresse" name="adresse" required autocomplete="street-address"></textarea>

        <label for="geburt">Geburtsdatum:</label>
        <input type="date" id="geburt" name="geburt" required autocomplete="bday">

        <label for="nummer">Versichertennummer:</label>
        <input type="text" id="nummer" name="nummer" required autocomplete="off" inputmode="text">
      </fieldset>

      <fieldset>
        <legend>Krankenkasse</legend>

        <label for="kasse">Name der Krankenkasse:</label>
        <input type="text" id="kasse" name="kasse" required autocomplete="organization">

        <label for="kassenAdresse">Vollst√§ndige Adresse der Krankenkasse:</label>
        <textarea id="kassenAdresse" name="kassenAdresse" required autocomplete="street-address"></textarea>
      </fieldset>

      <fieldset>
        <legend>Angaben zur Therapiebed√ºrftigkeit</legend>

        <label for="beschwerden_diagnose">Kurze Beschreibung Ihrer Beschwerden/Diagnose:</label>
        <textarea id="beschwerden_diagnose" name="beschwerden_diagnose" rows="5" required autocomplete="off"></textarea>
      </fieldset>

      <fieldset>
        <legend>Nachweis der Therapeutensuche (manuelle Eingabe)</legend>
        <p class="info-box">
          Bitte dokumentieren Sie hier Ihre Versuche, einen Therapieplatz bei kassenzugelassenen Psychotherapeut:innen zu finden.
          Die Anzahl ‚Äûmindestens 5‚Äú ist eine praktische Mindestgr√∂√üe, aber rechtlich ist entscheidend, ob die Leistung im konkreten Fall nicht rechtzeitig erreichbar war. 
        </p>

        <div id="kontaktversucheContainer">
          <fieldset>
            <legend>Kontaktversuch 1 (Pflicht)</legend>
            <label for="kontakt_name_0">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_0" name="kontakt_name_0" required autocomplete="off">
            <label for="kontakt_datum_0">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_0" name="kontakt_datum_0" required autocomplete="off">
            <label for="kontakt_art_0">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_0" name="kontakt_art_0" required autocomplete="off">
            <label for="kontakt_ergebnis_0">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_0" name="kontakt_ergebnis_0" required autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 2 (Pflicht)</legend>
            <label for="kontakt_name_1">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_1" name="kontakt_name_1" required autocomplete="off">
            <label for="kontakt_datum_1">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_1" name="kontakt_datum_1" required autocomplete="off">
            <label for="kontakt_art_1">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_1" name="kontakt_art_1" required autocomplete="off">
            <label for="kontakt_ergebnis_1">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_1" name="kontakt_ergebnis_1" required autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 3 (Pflicht)</legend>
            <label for="kontakt_name_2">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_2" name="kontakt_name_2" required autocomplete="off">
            <label for="kontakt_datum_2">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_2" name="kontakt_datum_2" required autocomplete="off">
            <label for="kontakt_art_2">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_2" name="kontakt_art_2" required autocomplete="off">
            <label for="kontakt_ergebnis_2">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_2" name="kontakt_ergebnis_2" required autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 4 (Pflicht)</legend>
            <label for="kontakt_name_3">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_3" name="kontakt_name_3" required autocomplete="off">
            <label for="kontakt_datum_3">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_3" name="kontakt_datum_3" required autocomplete="off">
            <label for="kontakt_art_3">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_3" name="kontakt_art_3" required autocomplete="off">
            <label for="kontakt_ergebnis_3">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_3" name="kontakt_ergebnis_3" required autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 5 (Pflicht)</legend>
            <label for="kontakt_name_4">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_4" name="kontakt_name_4" required autocomplete="off">
            <label for="kontakt_datum_4">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_4" name="kontakt_datum_4" required autocomplete="off">
            <label for="kontakt_art_4">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_4" name="kontakt_art_4" required autocomplete="off">
            <label for="kontakt_ergebnis_4">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_4" name="kontakt_ergebnis_4" required autocomplete="off">
          </fieldset>

          <!-- Kontakt 6..10 optional -->
          <fieldset>
            <legend>Kontaktversuch 6 (Optional)</legend>
            <label for="kontakt_name_5">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_5" name="kontakt_name_5" autocomplete="off">
            <label for="kontakt_datum_5">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_5" name="kontakt_datum_5" autocomplete="off">
            <label for="kontakt_art_5">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_5" name="kontakt_art_5" autocomplete="off">
            <label for="kontakt_ergebnis_5">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_5" name="kontakt_ergebnis_5" autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 7 (Optional)</legend>
            <label for="kontakt_name_6">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_6" name="kontakt_name_6" autocomplete="off">
            <label for="kontakt_datum_6">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_6" name="kontakt_datum_6" autocomplete="off">
            <label for="kontakt_art_6">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_6" name="kontakt_art_6" autocomplete="off">
            <label for="kontakt_ergebnis_6">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_6" name="kontakt_ergebnis_6" autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 8 (Optional)</legend>
            <label for="kontakt_name_7">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_7" name="kontakt_name_7" autocomplete="off">
            <label for="kontakt_datum_7">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_7" name="kontakt_datum_7" autocomplete="off">
            <label for="kontakt_art_7">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_7" name="kontakt_art_7" autocomplete="off">
            <label for="kontakt_ergebnis_7">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_7" name="kontakt_ergebnis_7" autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 9 (Optional)</legend>
            <label for="kontakt_name_8">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_8" name="kontakt_name_8" autocomplete="off">
            <label for="kontakt_datum_8">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_8" name="kontakt_datum_8" autocomplete="off">
            <label for="kontakt_art_8">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_8" name="kontakt_art_8" autocomplete="off">
            <label for="kontakt_ergebnis_8">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_8" name="kontakt_ergebnis_8" autocomplete="off">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 10 (Optional)</legend>
            <label for="kontakt_name_9">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_9" name="kontakt_name_9" autocomplete="off">
            <label for="kontakt_datum_9">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_9" name="kontakt_datum_9" autocomplete="off">
            <label for="kontakt_art_9">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_9" name="kontakt_art_9" autocomplete="off">
            <label for="kontakt_ergebnis_9">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_9" name="kontakt_ergebnis_9" autocomplete="off">
          </fieldset>
        </div>
      </fieldset>

      <fieldset class="protokoll-anzeige-bereich">
        <legend>√úbersicht: Bereits kontaktierte Therapeut:innen (aus Kontaktprotokoll)</legend>
        <p class="protokoll-hinweis">Diese Daten stammen aus dem Kontaktprotokoll-Tool und k√∂nnen nur dort bearbeitet werden.</p>
        <div id="protokollAnzeigeBereitsKontaktiert"></div>
      </fieldset>

      <fieldset class="protokoll-anzeige-bereich">
        <legend>√úbersicht: Geplante Kontakte (aus Kontaktprotokoll)</legend>
        <p class="protokoll-hinweis">Diese Daten stammen aus dem Kontaktprotokoll-Tool und k√∂nnen nur dort bearbeitet werden.</p>
        <div id="protokollAnzeigeNochZuKontaktieren"></div>
      </fieldset>

      <fieldset>
        <legend>Gew√ºnschte:r Therapeut:in (f√ºr Kostenerstattung)</legend>

        <label for="therapeut">Vor- und Nachname des/der Therapeut:in:</label>
        <input type="text" id="therapeut" name="therapeut" autocomplete="name">

        <label for="therapeutAdresse">Praxisadresse des/der Therapeut:in:</label>
        <textarea id="therapeutAdresse" name="therapeutAdresse" autocomplete="street-address"></textarea>

        <label for="approbiert">Approbation vorhanden?</label>
        <select id="approbiert" name="approbiert" autocomplete="off">
          <option value="Ja" selected>Ja</option>
          <option value="Nein">Nein</option>
        </select>

        <label for="kassenzulassung">Hat der/die Therapeut:in eine Kassenzulassung?</label>
        <select id="kassenzulassung" name="kassenzulassung" autocomplete="off">
          <option value="Nein" selected>Nein</option>
          <option value="Ja">Ja</option>
        </select>

        <label for="verfuegbar">Kann die Behandlung zeitnah begonnen werden?</label>
        <select id="verfuegbar" name="verfuegbar" autocomplete="off">
          <option value="Ja" selected>Ja</option>
          <option value="Nein">Nein</option>
        </select>
      </fieldset>

      <div class="button-group">
        <button type="button" id="saveBtn" class="button-secondary">Eingaben im Browser speichern</button>
        <button type="button" id="loadBtn" class="button-secondary">Gespeicherte Eingaben laden</button>
        <button type="submit" class="button-primary">üìÑ PDF erstellen</button>
      </div>
    </form>
  </div>

  <div id="spendenPopupPsych" class="popup-overlay">
    <div class="popup-content">
      <h2>Danke f√ºr deine Nutzung üíõ</h2>
      <p>Wenn dir dieses Tool geholfen hat, unterst√ºtze das Projekt gerne mit einer kleinen Spende:</p>
      <form action="https://www.paypal.com/donate" method="post" target="_blank">
        <input type="hidden" name="business" value="info@kassen-lotse.de" />
        <input type="hidden" name="charset" value="utf-8">
        <input type="hidden" name="item_name" value="Unterst√ºtzung f√ºr das Projekt Helfer Antr√§ge & Widerspr√ºche" />
        <input type="hidden" name="currency_code" value="EUR" />
        <input type="submit" value="Spenden mit PayPal" />
      </form>
      <button id="closePopupBtnPsych" class="popup-close-button">Schlie√üen</button>
    </div>
  </div>

  <footer>
    <div class="mini-footer-hint">
      <p>Brauchen Sie mehr Unterst√ºtzung bei Antr√§gen, Beh√∂rdenbriefen oder komplexen Schreiben?</p>
      <a href="https://clerion.de" class="mini-footer-link">Clerion - Ihr digitaler Beh√∂rden-Assistent</a>
    </div>
    <p>&copy; 2025 Kassen-Lotse | <a href="√ºber.html">√úber uns</a> | <a href="index.html">Zur√ºck zur Startseite</a> | <a href="info-kostenerstattung.html">Infos Kostenerstattung</a> | <a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Datenschutz</a></p>
  </footer>



<script>
// ... (Anfang von script.js, wie er bereits existiert) ...

document.addEventListener('DOMContentLoaded', function() {
    // ... (Variablen und Funktionen f√ºr Antragsdaten und PDF-Erstellung wie gehabt) ...
    const form = document.getElementById('antragForm');
    const saveBtn = document.getElementById('saveBtn');
    const loadBtn = document.getElementById('loadBtn');
    const storageKeyAntrag = 'antragFormData'; // F√ºr Antragsdaten

    const antragFormElementIds = [
      "name", "adresse", "geburt", "nummer", "kasse", "kassenAdresse", "beschwerden_diagnose",
      "therapeut", "therapeutAdresse", "approbiert", "kassenzulassung", "verfuegbar"
    ];
    const kontaktBaseIds = ["kontakt_name_", "kontakt_datum_", "kontakt_art_", "kontakt_ergebnis_"];
    const maxManuelleKontakte = 10;

    function getAntragFormData() {
      const data = {};
      antragFormElementIds.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          data[id] = element.value;
        }
      });
      data.manuelleKontakte = [];
      for (let i = 0; i < maxManuelleKontakte; i++) {
        const kontakt = {};
        let hasDataInKontakt = false;
        kontaktBaseIds.forEach(baseId => {
          const element = document.getElementById(baseId + i);
          if (element) {
            const value = element.value;
            kontakt[baseId.replace('kontakt_', '').replace('_','')] = value;
            if (value && value.trim() !== "") hasDataInKontakt = true;
          }
        });
         data.manuelleKontakte.push(kontakt);
      }
      return data;
    }

    function populateAntragForm(data) {
      antragFormElementIds.forEach(id => {
        const element = document.getElementById(id);
        if (element && data[id] !== undefined) {
          element.value = data[id];
        }
      });
      if (data.manuelleKontakte) {
        for (let i = 0; i < maxManuelleKontakte; i++) {
          if (data.manuelleKontakte[i]) {
            kontaktBaseIds.forEach(baseId => {
              const element = document.getElementById(baseId + i);
              const key = baseId.replace('kontakt_', '').replace('_','');
              if (element && data.manuelleKontakte[i][key] !== undefined) {
                element.value = data.manuelleKontakte[i][key];
              }
            });
          }
        }
      }
    }

    if (saveBtn) {
        saveBtn.addEventListener('click', function() {
          const data = getAntragFormData();
          localStorage.setItem(storageKeyAntrag, JSON.stringify(data));
          alert('Ihre Eingaben wurden im Browser gespeichert!');
        });
    }

    if (loadBtn) {
        loadBtn.addEventListener('click', function() {
          const savedData = localStorage.getItem(storageKeyAntrag);
          if (savedData) {
            try {
                const data = JSON.parse(savedData);
                populateAntragForm(data);
                alert('Gespeicherte Eingaben wurden geladen!');
            } catch (e) {
                alert('Fehler beim Laden der Daten. M√∂glicherweise sind sie besch√§digt.');
                console.error("Fehler beim Parsen der Antragsdaten: ", e);
            }
          } else {
            alert('Keine gespeicherten Daten f√ºr den Antrag gefunden.');
          }
        });
    }
    
    const autoLoadAntragData = localStorage.getItem(storageKeyAntrag);
    if (autoLoadAntragData) {
      try {
        const data = JSON.parse(autoLoadAntragData);
        populateAntragForm(data);
        console.log('Antragsdaten automatisch aus localStorage geladen.');
      } catch (e) {
        console.error("Fehler beim Parsen der localStorage Antragsdaten: ", e);
        localStorage.removeItem(storageKeyAntrag); 
      }
    }

    // --- ANGEPASSTE FUNKTION ZUM LADEN UND ANZEIGEN DER PROTOKOLLDATEN ---
    function loadAndDisplayProtokollData() {
        const protokollStorageKey = 'kontaktProtokollData';
        const anzeigeBereitsKontaktiertDiv = document.getElementById('protokollAnzeigeBereitsKontaktiert');
        const anzeigeNochZuKontaktierenDiv = document.getElementById('protokollAnzeigeNochZuKontaktieren');

        if (!anzeigeBereitsKontaktiertDiv || !anzeigeNochZuKontaktierenDiv) {
            return; // Elemente nicht auf dieser Seite vorhanden
        }

        // Mapping f√ºr die lesbare Anzeige der Status-IDs (identisch zu protokoll-script.js)
        const statusMapBereitsKontaktiert = {
            'absage_kapazitaeten': 'Absage (keine Kapazit√§ten)',
            'absage_privat': 'Absage (nur Privatpatienten/Selbstzahler)',
            'wartezeit_genannt': 'Wartezeit genannt',
            'warteliste_platz': 'Auf Warteliste gesetzt',
            'termin_sprechstunde': 'Termin f√ºr Sprechstunde/Erstgespr√§ch',
            'keine_antwort': 'Keine Antwort/R√ºckmeldung',
            'nicht_erreicht': 'Telefonisch nicht erreicht',
            'sonstiges': 'Sonstiges'
        };

        const savedProtokollData = localStorage.getItem(protokollStorageKey);

        if (savedProtokollData) {
            try {
                const data = JSON.parse(savedProtokollData);
                let htmlBereits = '';
                let htmlNoch = '';

                // "Bereits kontaktiert" Eintr√§ge verarbeiten
                if (data.bereitsKontaktiert && data.bereitsKontaktiert.length > 0) {
                    data.bereitsKontaktiert.forEach(item => {
                        htmlBereits += `
                            <div class="protokoll-anzeige-eintrag">
                                <p><strong>Name:</strong> ${item.name || 'N/A'}</p>
                                <p><strong>Datum:</strong> ${item.datum ? new Date(item.datum).toLocaleDateString('de-DE', { year: 'numeric', month: '2-digit', day: '2-digit' }) : 'N/A'}</p>
                                <p><strong>Art:</strong> ${item.art || 'N/A'}</p>
                                <p><strong>Status:</strong> ${statusMapBereitsKontaktiert[item.status] || item.status || 'N/A'}</p>
                                <p><strong>Notizen:</strong> ${item.ergebnis || 'N/A'}</p>
                            </div>
                        `;
                    });
                } else {
                    htmlBereits = '<p>Keine Eintr√§ge zu "Bereits kontaktiert" im <a href="kontaktprotokoll.html" target="_blank">Kontaktprotokoll</a> gefunden.</p>';
                }
                anzeigeBereitsKontaktiertDiv.innerHTML = htmlBereits;

                // "Noch zu kontaktieren" Eintr√§ge verarbeiten (ohne Status)
                if (data.nochZuKontaktieren && data.nochZuKontaktieren.length > 0) {
                    data.nochZuKontaktieren.forEach(item => {
                        htmlNoch += `
                            <div class="protokoll-anzeige-eintrag">
                                <p><strong>Name:</strong> ${item.name || 'N/A'}</p>
                                <p><strong>Kontaktinfo:</strong> ${item.kontaktinfo || 'N/A'}</p>
                                <p><strong>Planung:</strong> ${item.erreichbarkeit || 'N/A'}</p>
                            </div>
                        `;
                    });
                } else {
                    htmlNoch = '<p>Keine Eintr√§ge zu "Noch zu kontaktieren" im <a href="kontaktprotokoll.html" target="_blank">Kontaktprotokoll</a> gefunden.</p>';
                }
                anzeigeNochZuKontaktierenDiv.innerHTML = htmlNoch;

            } catch (e) {
                console.error("Fehler beim Parsen der Protokolldaten f√ºr die Anzeige: ", e);
                anzeigeBereitsKontaktiertDiv.innerHTML = '<p>Fehler beim Laden der Protokolldaten. Bitte √ºberpr√ºfen Sie das <a href="kontaktprotokoll.html" target="_blank">Kontaktprotokoll</a>.</p>';
                anzeigeNochZuKontaktierenDiv.innerHTML = '<p>Fehler beim Laden der Protokolldaten. Bitte √ºberpr√ºfen Sie das <a href="kontaktprotokoll.html" target="_blank">Kontaktprotokoll</a>.</p>';
            }
        } else {
            const hinweisText = `<p>Keine Daten im <a href="kontaktprotokoll.html" target="_blank">Kontaktprotokoll</a> gefunden. Bitte dort eintragen und speichern, um sie hier zu sehen.</p>`;
            anzeigeBereitsKontaktiertDiv.innerHTML = hinweisText;
            anzeigeNochZuKontaktierenDiv.innerHTML = hinweisText;
        }
    }
    // --- ENDE DER ANGEPASSTEN FUNKTION ---

    if (document.getElementById('protokollAnzeigeBereitsKontaktiert')) {
       loadAndDisplayProtokollData();
    }

    if (form) {
        form.addEventListener("submit", function(e) {
            e.preventDefault();
            
            let ausgefuelltePflichtKontakte = 0;
            for (let i = 0; i < 5; i++) {
                if (document.getElementById(`kontakt_name_${i}`) && document.getElementById(`kontakt_name_${i}`).value.trim() !== "" &&
                    document.getElementById(`kontakt_datum_${i}`) && document.getElementById(`kontakt_datum_${i}`).value.trim() !== "" &&
                    document.getElementById(`kontakt_art_${i}`) && document.getElementById(`kontakt_art_${i}`).value.trim() !== "" &&
                    document.getElementById(`kontakt_ergebnis_${i}`) && document.getElementById(`kontakt_ergebnis_${i}`).value.trim() !== "") {
                   ausgefuelltePflichtKontakte++;
                }
            }

            if (ausgefuelltePflichtKontakte < 5) {
                alert("Bitte f√ºllen Sie mindestens die ersten 5 manuellen Kontaktversuche (Kontaktversuch 1 bis 5) vollst√§ndig aus.");
                for (let i = 0; i < 5; i++) {
                    if (document.getElementById(`kontakt_name_${i}`) && !document.getElementById(`kontakt_name_${i}`).value.trim()) { document.getElementById(`kontakt_name_${i}`).focus(); break; }
                    if (document.getElementById(`kontakt_datum_${i}`) &&!document.getElementById(`kontakt_datum_${i}`).value.trim()) { document.getElementById(`kontakt_datum_${i}`).focus(); break; }
                    if (document.getElementById(`kontakt_art_${i}`) && !document.getElementById(`kontakt_art_${i}`).value.trim()) { document.getElementById(`kontakt_art_${i}`).focus(); break; }
                    if (document.getElementById(`kontakt_ergebnis_${i}`) && !document.getElementById(`kontakt_ergebnis_${i}`).value.trim()) { document.getElementById(`kontakt_ergebnis_${i}`).focus(); break; }
                }
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: "portrait",
                unit: "mm",
                format: "a4"
            });

            const margin = 20;
            const pageHeight = doc.internal.pageSize.getHeight();
            const pageWidth = doc.internal.pageSize.getWidth();
            let y = margin;
            const defaultLineHeight = 7;
            const spaceAfterParagraph = 2;

            function ensurePageSpace(neededHeight) {
                if (y + neededHeight > pageHeight - margin) { // Check against bottom margin
                    doc.addPage();
                    y = margin;
                }
            }

            function writeLine(text, currentLineHeight = defaultLineHeight, isBold = false, fontSize = 11) {
                ensurePageSpace(currentLineHeight);
                doc.setFontSize(fontSize);
                doc.setFont(undefined, isBold ? "bold" : "normal");
                doc.text(text, margin, y);
                y += currentLineHeight;
            }
            
            function writeParagraph(text, paragraphLineHeight = defaultLineHeight, paragraphFontSize = 11, isBold = false) {
                doc.setFontSize(paragraphFontSize);
                doc.setFont(undefined, isBold ? "bold" : "normal");
                const lines = doc.splitTextToSize(text, pageWidth - (2 * margin));
            
                for (let i = 0; i < lines.length; i++) {
                  ensurePageSpace(paragraphLineHeight);
                  doc.text(lines[i], margin, y);
                  y += paragraphLineHeight;
                }
                if (lines.length > 0) {
                    ensurePageSpace(spaceAfterParagraph); // Ensure space for the gap itself
                    y += spaceAfterParagraph;
                }
            }

            const formData = getAntragFormData(); 

            writeLine(formData.name);
            formData.adresse.split("\n").forEach(line => {
                if (line.trim() !== "") writeLine(line);
            });
            ensurePageSpace(defaultLineHeight * 0.5); y += defaultLineHeight * 0.5;

            writeLine(formData.kasse);
            formData.kassenAdresse.split("\n").forEach(line => {
                if (line.trim() !== "") writeLine(line);
            });
            ensurePageSpace(defaultLineHeight * 1.5); y += defaultLineHeight * 1.5; 

            const datumHeute = new Date().toLocaleDateString("de-DE");
            const datumsFontSize = 11;
            doc.setFontSize(datumsFontSize);
            const datumsBreite = doc.getStringUnitWidth(datumHeute) * datumsFontSize / doc.internal.scaleFactor;
            ensurePageSpace(defaultLineHeight); // Space for the date line itself
            doc.text(datumHeute, pageWidth - margin - datumsBreite, y);
            y += defaultLineHeight * 2; 

            writeParagraph("Antrag auf Kostenerstattung f√ºr ambulante Psychotherapie gem√§√ü ¬ß 13 Abs. 3 SGB V", defaultLineHeight +1, 12, true);
            
            const geburtFormatted = formData.geburt ? new Date(formData.geburt).toLocaleDateString("de-DE") : 'N/A';
            writeParagraph(`Sehr geehrte Damen und Herren,`);
            y -= spaceAfterParagraph; 
            ensurePageSpace(defaultLineHeight * 0.5); y += defaultLineHeight * 0.5;

            writeParagraph(`hiermit beantrage ich, ${formData.name}, geboren am ${geburtFormatted}, Versichertennummer ${formData.nummer}, die Kosten√ºbernahme f√ºr eine ambulante psychotherapeutische Behandlung im Rahmen des Kostenerstattungsverfahrens gem√§√ü ¬ß 13 Abs. 3 SGB V.`);
            writeParagraph(`Ich leide unter ${formData.beschwerden_diagnose} und ben√∂tige dringend psychotherapeutische Unterst√ºtzung. Eine entsprechende Notwendigkeitsbescheinigung liegt diesem Antrag bei / wird nachgereicht.`);
            
            writeParagraph("Begr√ºndung der Notwendigkeit und Dringlichkeit der Behandlung:", defaultLineHeight, 11, true);
            writeParagraph(`Trotz intensiver und dokumentierter Bem√ºhungen war es mir nicht m√∂glich, innerhalb einer zumutbaren Frist einen Behandlungsplatz bei einem oder einer niedergelassenen, kassenzugelassenen Psychotherapeut:in zu finden. Die Wartezeiten bei den kontaktierten Therapeut:innen sind unzumutbar lang und/oder es besteht ein Aufnahmestopp.`);
            writeParagraph(`Meine erfolglosen Kontaktversuche (manuelle Eingabe aus dem Formular) sind im Folgenden detailliert aufgef√ºhrt:`);
            
            if (formData.manuelleKontakte && formData.manuelleKontakte.length > 0) {
                let kontaktCounter = 0;
                formData.manuelleKontakte.forEach((k) => {
                    if (k.name && k.name.trim() !== "") {
                        kontaktCounter++;
                        const kontaktDatumFormatted = k.datum ? new Date(k.datum).toLocaleDateString("de-DE") : 'N/A';
                        const kontaktText = `${kontaktCounter}. ${k.name || 'N/A'}:\n   Kontaktiert am ${kontaktDatumFormatted} per ${k.art || 'N/A'}\n   Ergebnis: ${k.ergebnis || 'N/A'}`;
                        writeParagraph(kontaktText, defaultLineHeight -1, 10);
                    }
                });
                if (kontaktCounter === 0) {
                     writeParagraph("Keine manuellen Kontaktversuche im Formular ausgef√ºllt.", defaultLineHeight -1, 10);
                }
            } else {
                writeParagraph("Keine manuellen Kontaktversuche im Formular ausgef√ºllt.", defaultLineHeight -1, 10);
            }
            
            writeParagraph("Behandlung bei einem/einer Privattherapeut:in:", defaultLineHeight, 11, true);
            writeParagraph(`Da eine zeitnahe Behandlung im Kassensystem nicht realisierbar ist, aber zur Vermeidung einer Verschlechterung meines Gesundheitszustandes bzw. zur Chronifizierung dringend erforderlich ist, beabsichtige ich, die Behandlung bei`);
            writeParagraph(`   ${formData.therapeut || '[Name des/der Privattherapeut:in noch eintragen]'}\n   ${(formData.therapeutAdresse || '').replace(/\n/g, '\n   ') || '[Adresse des/der Privattherapeut:in noch eintragen]'}`, defaultLineHeight, 11);
            writeParagraph(`durchf√ºhren zu lassen.`);
            writeParagraph(`Herr/Frau ${formData.therapeut ? formData.therapeut.split(' ').pop() : '[Nachname Therapeut:in]'} ist approbierte:r Psychotherapeut:in (Approbation: ${formData.approbiert}). Eine Kassenzulassung besteht ${formData.kassenzulassung === 'Nein' ? 'nicht' : ' (Hinweis: F√ºr Kostenerstattung ist "Nein" hier i.d.R. die Voraussetzung)'}. Die Behandlung kann dort zeitnah (${formData.verfuegbar === 'Ja' ? 'sofort bzw. kurzfristig' : 'nach Absprache'}) begonnen werden. Eine Bescheinigung des/der Therapeut:in √ºber die Approbation, die Notwendigkeit der Behandlung und die Behandlungsbereitschaft liegt bei / wird nachgereicht.`);
            
            writeParagraph("Bitte um Kosten√ºbernahme und weitere Schritte:", defaultLineHeight, 11, true);
            writeParagraph(`Ich bitte Sie h√∂flich um eine schriftliche Best√§tigung der Kosten√ºbernahme f√ºr die probatorischen Sitzungen sowie f√ºr die anschlie√üende Therapie.`);
            writeParagraph(`Bitte teilen Sie mir mit, welche weiteren Unterlagen Sie gegebenenfalls von mir oder von dem/der gew√§hlten Therapeut:in ben√∂tigen.`);
            writeParagraph(`F√ºr eine zeitnahe positive R√ºckmeldung w√§re ich Ihnen sehr dankbar.`);

            writeParagraph("Mit freundlichen Gr√º√üen");
            ensurePageSpace(defaultLineHeight * 2.5); // Space for gap + name
            y += defaultLineHeight * 1.5; 
            writeParagraph(formData.name);

            doc.save("antrag_kostenerstattung_psychotherapie.pdf");

            const popup = document.getElementById("spendenPopup");
            if (popup) {
                popup.style.display = "flex";
            }
        });
    }

    if (typeof closePopup !== 'function') {
        window.closePopup = function() {
            const popup = document.getElementById("spendenPopup");
            if (popup) {
                popup.style.display = "none";
            }
        }
    }
});
</script>

</body>
</html>
