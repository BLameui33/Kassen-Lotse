<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kostenerstattungs-Antrag Psychotherapie</title>
  <meta name="description" content="Antrag auf Kostenerstattung f√ºr Psychotherapie: Kontaktversuche, Begr√ºndung und PDF-Erzeugung.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/logo-lotse-fav.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Optional: du kannst komplexe Logik in eine separate Datei auslagern -->
  <script defer src="kostenerstattung_psychotherapie_script.js"></script>
  <link rel="stylesheet" href="/css/generator.css">
  <style>
    /* kleine Erg√§nzungen, damit bestimmte Elemente aus dem Original gut aussehen */
    .protokoll-anzeige-bereich legend {
      font-size: 1.05em;
      color: #444;
      font-weight: 600;
    }
    .protokoll-anzeige-eintrag {
      background-color: #f8f9fa;
      border: 1px solid #e9ecef;
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      font-size: 0.95em;
    }
    .protokoll-hinweis {
      font-size: 0.95em;
      color: #555;
      margin-bottom: 1rem;
      background-color: #eef7ff;
      padding: 8px;
      border-radius: 4px;
      border-left: 3px solid #0070f3;
    }
  </style>
</head>
<body>

  <header class="site-header">
    <a href="index.html" class="site-logo">Kassen-Lotse</a>
  </header>

  <div class="page-container">
    <h1>Antrag auf Kostenerstattung Psychotherapie</h1>

    <p class="info-box">
      F√ºllen Sie dieses Formular sorgf√§ltig aus, um Ihren Antrag auf Kostenerstattung f√ºr Psychotherapie zu erstellen. Ihre Eingaben k√∂nnen Sie im Browser zwischenspeichern.
    </p>

    <p class="info-box" style="background-color: #fff8e1; border-left: 4px solid #ff9800; padding: 10px; margin-top: 10px;">
      <strong>Hinweis:</strong> Unsere Inhalte und Formulare ersetzen keine Rechtsberatung. Sie dienen der allgemeinen Unterst√ºtzung. F√ºr verbindliche Ausk√ºnfte wenden Sie sich bitte an eine anerkannte Beratungsstelle oder einen Rechtsanwalt.
    </p>

    <p class="highlight-box" style="background-color: #fff3f3; border-left: 4px solid #e53935; padding: 10px; margin-top: 10px;">
      <strong>Technischer Hinweis:</strong> Um das PDF erfolgreich herunterzuladen, √∂ffnen Sie diese Seite bitte in einem Internet-Browser wie <strong>Chrome, Firefox oder Safari</strong>. In der Google-App funktioniert der Download nicht zuverl√§ssig.
    </p>

    <form id="antragForm">
      <fieldset>
        <legend>Pers√∂nliche Angaben</legend>
        <label for="name">Vor- und Nachname:</label>
        <input type="text" id="name" required>

        <label for="adresse">Ihre vollst√§ndige Adresse: <small>(Stra√üe, Hausnummer, PLZ, Ort)</small></label>
        <textarea id="adresse" required></textarea>

        <label for="geburt">Geburtsdatum:</label>
        <input type="date" id="geburt" required>

        <label for="nummer">Versichertennummer:</label>
        <input type="text" id="nummer" required>
      </fieldset>

      <fieldset>
        <legend>Krankenkasse</legend>
        <label for="kasse">Name der Krankenkasse:</label>
        <input type="text" id="kasse" required>

        <label for="kassenAdresse">Vollst√§ndige Adresse der Krankenkasse:</label>
        <textarea id="kassenAdresse" required></textarea>
      </fieldset>

      <fieldset>
        <legend>Angaben zur Therapiebed√ºrftigkeit</legend>
        <label for="beschwerden_diagnose">Kurze Beschreibung Ihrer Beschwerden/Diagnose:</label>
        <textarea id="beschwerden_diagnose" rows="5" required></textarea>
      </fieldset>

      <fieldset>
        <legend>Nachweis der Therapeutensuche (manuelle Eingabe)</legend>
        <p class="info-box">Bitte dokumentieren Sie hier Ihre vergeblichen Versuche, einen Therapieplatz bei kassenzugelassenen Psychotherapeut:innen zu finden. Mindestens 5 Versuche sind erforderlich. Maximal 10 k√∂nnen eingetragen werden.</p>

        <!-- Kontaktversuche 0..9 (IDs bleiben erhalten) -->
        <!-- Wir behalten die gleiche Struktur wie zuvor, damit bestehende JS/Tools kompatibel bleiben -->
        <div id="kontaktversucheContainer">
          <!-- Kontakt 1..10: je eine kleine Gruppe -->
          <!-- F√ºr Platzsparnis hier nur eine Vorlage (du hast bereits alle Felder, wir f√ºllen sie in JS) -->
          <!-- -> wir geben alle Felder einzeln (wie Original), damit Save/Load exakt funktioniert -->
          <!-- Kontakt 1 -->
          <fieldset>
            <legend>Kontaktversuch 1 (Pflicht)</legend>
            <label for="kontakt_name_0">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_0" required>
            <label for="kontakt_datum_0">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_0" required>
            <label for="kontakt_art_0">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_0" required>
            <label for="kontakt_ergebnis_0">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_0" required>
          </fieldset>

          <!-- Kontakt 2 -->
          <fieldset>
            <legend>Kontaktversuch 2 (Pflicht)</legend>
            <label for="kontakt_name_1">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_1" required>
            <label for="kontakt_datum_1">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_1" required>
            <label for="kontakt_art_1">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_1" required>
            <label for="kontakt_ergebnis_1">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_1" required>
          </fieldset>

          <!-- Kontakt 3 -->
          <fieldset>
            <legend>Kontaktversuch 3 (Pflicht)</legend>
            <label for="kontakt_name_2">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_2" required>
            <label for="kontakt_datum_2">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_2" required>
            <label for="kontakt_art_2">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_2" required>
            <label for="kontakt_ergebnis_2">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_2" required>
          </fieldset>

          <!-- Kontakt 4 -->
          <fieldset>
            <legend>Kontaktversuch 4 (Pflicht)</legend>
            <label for="kontakt_name_3">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_3" required>
            <label for="kontakt_datum_3">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_3" required>
            <label for="kontakt_art_3">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_3" required>
            <label for="kontakt_ergebnis_3">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_3" required>
          </fieldset>

          <!-- Kontakt 5 -->
          <fieldset>
            <legend>Kontaktversuch 5 (Pflicht)</legend>
            <label for="kontakt_name_4">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_4" required>
            <label for="kontakt_datum_4">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_4" required>
            <label for="kontakt_art_4">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_4" required>
            <label for="kontakt_ergebnis_4">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_4" required>
          </fieldset>

          <!-- Kontakt 6..10 (optional) -->
          <fieldset>
            <legend>Kontaktversuch 6 (Optional)</legend>
            <label for="kontakt_name_5">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_5">
            <label for="kontakt_datum_5">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_5">
            <label for="kontakt_art_5">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_5">
            <label for="kontakt_ergebnis_5">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_5">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 7 (Optional)</legend>
            <label for="kontakt_name_6">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_6">
            <label for="kontakt_datum_6">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_6">
            <label for="kontakt_art_6">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_6">
            <label for="kontakt_ergebnis_6">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_6">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 8 (Optional)</legend>
            <label for="kontakt_name_7">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_7">
            <label for="kontakt_datum_7">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_7">
            <label for="kontakt_art_7">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_7">
            <label for="kontakt_ergebnis_7">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_7">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 9 (Optional)</legend>
            <label for="kontakt_name_8">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_8">
            <label for="kontakt_datum_8">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_8">
            <label for="kontakt_art_8">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_8">
            <label for="kontakt_ergebnis_8">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_8">
          </fieldset>

          <fieldset>
            <legend>Kontaktversuch 10 (Optional)</legend>
            <label for="kontakt_name_9">Name des Therapeuten/der Praxis:</label>
            <input type="text" id="kontakt_name_9">
            <label for="kontakt_datum_9">Datum des Kontakts:</label>
            <input type="date" id="kontakt_datum_9">
            <label for="kontakt_art_9">Art des Kontakts:</label>
            <input type="text" id="kontakt_art_9">
            <label for="kontakt_ergebnis_9">Ergebnis/Antwort:</label>
            <input type="text" id="kontakt_ergebnis_9">
          </fieldset>
        </div>
      </fieldset>

      <fieldset class="protokoll-anzeige-bereich">
        <legend>√úbersicht: Bereits kontaktierte Therapeut:innen (aus Kontaktprotokoll)</legend>
        <p class="protokoll-hinweis">Diese Daten stammen aus dem Kontaktprotokoll-Tool und k√∂nnen nur dort bearbeitet werden.</p>
        <div id="protokollAnzeigeBereitsKontaktiert"></div>
      </fieldset>

      <fieldset class="protokoll-anzeige-bereich">
        <legend>√úbersicht: Geplante Kontakte (aus Kontaktprotokoll)</legend>
        <p class="protokoll-hinweis">Diese Daten stammen aus dem Kontaktprotokoll-Tool und k√∂nnen nur dort bearbeitet werden.</p>
        <div id="protokollAnzeigeNochZuKontaktieren"></div>
      </fieldset>

      <fieldset>
        <legend>Gew√ºnschte:r Therapeut:in (f√ºr Kostenerstattung)</legend>
        <label for="therapeut">Vor- und Nachname des/der Therapeut:in:</label>
        <input type="text" id="therapeut">
        <label for="therapeutAdresse">Praxisadresse des/der Therapeut:in:</label>
        <textarea id="therapeutAdresse"></textarea>
        <label for="approbiert">Approbation vorhanden?</label>
        <select id="approbiert">
          <option value="Ja" selected>Ja</option>
          <option value="Nein">Nein</option>
        </select>
        <label for="kassenzulassung">Hat der/die Therapeut:in eine Kassenzulassung?</label>
        <select id="kassenzulassung">
          <option value="Nein" selected>Nein</option>
          <option value="Ja">Ja</option>
        </select>
        <label for="verfuegbar">Kann die Behandlung zeitnah begonnen werden?</label>
        <select id="verfuegbar">
          <option value="Ja" selected>Ja</option>
          <option value="Nein">Nein</option>
        </select>
      </fieldset>

      <div class="button-group">
        <button type="button" id="saveBtn" class="button-secondary">Eingaben im Browser speichern</button>
        <button type="button" id="loadBtn" class="button-secondary">Gespeicherte Eingaben laden</button>
        <button type="submit" class="button-primary">üìÑ PDF erstellen</button>
      </div>
    </form>
  </div>

  <!-- Spenden-Popup (angepasst an Namenskonvention) -->
  <div id="spendenPopupPsych" class="popup-overlay">
    <div class="popup-content">
      <h2>Danke f√ºr deine Nutzung üíõ</h2>
      <p>Wenn dir dieses Tool geholfen hat, unterst√ºtze das Projekt gerne mit einer kleinen Spende:</p>
      <form action="https://www.paypal.com/donate" method="post" target="_blank">
        <input type="hidden" name="business" value="info@kassen-lotse.de" />
        <input type="hidden" name="charset" value="utf-8">
        <input type="hidden" name="item_name" value="Unterst√ºtzung f√ºr das Projekt Helfer Antr√§ge & Widerspr√ºche" />
        <input type="hidden" name="currency_code" value="EUR" />
        <input type="submit" value="Spenden mit PayPal" />
      </form>
      <button id="closePopupBtnPsych" class="popup-close-button">Schlie√üen</button>
    </div>
  </div>

  <footer>
    <div class="mini-footer-hint">
      <p>Brauchen Sie mehr Unterst√ºtzung bei Antr√§gen, Beh√∂rdenbriefen oder komplexen Schreiben?</p>
      <a href="https://clerion.de" class="mini-footer-link">Clerion - Ihr digitaler Beh√∂rden-Assistent</a>
    </div>
    <p>&copy; 2025 Kassen-Lotse | <a href="index.html">Zur√ºck zur Startseite</a> | <a href="info-kostenerstattung.html">Infos Kostenerstattung</a> | <a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Datenschutz</a></p>
  </footer>

<script>
/* --- PDF-Erzeugung, Save/Load, Popup-Verhalten --- */

function collectKontaktversuche() {
  const attempts = [];
  for (let i = 0; i < 10; i++) {
    const name = document.getElementById(`kontakt_name_${i}`)?.value || "";
    const datum = document.getElementById(`kontakt_datum_${i}`)?.value || "";
    const art = document.getElementById(`kontakt_art_${i}`)?.value || "";
    const erg = document.getElementById(`kontakt_ergebnis_${i}`)?.value || "";
    if (name || datum || art || erg) {
      attempts.push({ name, datum, art, erg });
    }
  }
  return attempts;
}

document.getElementById("antragForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "mm", format: "a4" });

  // Sammle Felder
  const name = document.getElementById("name").value;
  const adresse = document.getElementById("adresse").value;
  const geburt = document.getElementById("geburt").value;
  const versichertennr = document.getElementById("nummer").value;
  const kasse = document.getElementById("kasse").value;
  const kassenAdresse = document.getElementById("kassenAdresse").value;
  const beschwerden = document.getElementById("beschwerden_diagnose").value;
  const therapeut = document.getElementById("therapeut").value;
  const therapeutAdresse = document.getElementById("therapeutAdresse").value;
  const approbiert = document.getElementById("approbiert").value;
  const kassenzulassung = document.getElementById("kassenzulassung").value;
  const verfuegbar = document.getElementById("verfuegbar").value;
  const kontaktversuche = collectKontaktversuche();

  // PDF Aufbau (√ºbersichtlich, aber schlicht)
  doc.setFont('Helvetica');
  doc.setFontSize(11);

  // Absender
  let y = 20;
  doc.setFontSize(10);
  doc.text(`${name}`, 20, y);
  y += 5;
  doc.text(splitText(adresse, 60), 20, y);
  y += 10;

  // Empf√§nger (Kasse)
  doc.setFontSize(11);
  doc.text(`An: ${kasse}`, 20, y);
  y += 6;
  doc.text(splitText(kassenAdresse, 60), 20, y);
  y += 14;

  // Betreff
  doc.setFont(undefined, 'bold');
  doc.text(`Antrag auf Kostenerstattung Psychotherapie`, 20, y);
  doc.setFont(undefined, 'normal');
  y += 8;

  // Einleitung / Versichertennr
  if (versichertennr) {
    doc.text(`Versichertennummer: ${versichertennr}`, 20, y);
    y += 8;
  }
  if (geburt) {
    const geb = new Date(geburt).toLocaleDateString('de-DE');
    doc.text(`Geburtsdatum: ${geb}`, 20, y);
    y += 8;
  }

  // Beschwerden / Begr√ºndung
  const beschrLines = doc.splitTextToSize(`Beschwerden / Diagnose:\n${beschwerden}`, 170);
  doc.text(beschrLines, 20, y);
  y += beschrLines.length * 6 + 6;

  // Gew√ºnschter Therapeut
  const thLines = doc.splitTextToSize(`Gew√ºnschte/r Therapeut/in:\n${therapeut}\n${therapeutAdresse}\nApprobation: ${approbiert} | Kassenzulassung: ${kassenzulassung} | zeitnahe Verf√ºgbarkeit: ${verfuegbar}`, 170);
  doc.text(thLines, 20, y);
  y += thLines.length * 6 + 6;

  // Kontaktversuche (Liste)
  if (kontaktversuche.length) {
    doc.setFont(undefined, 'bold');
    doc.text('Dokumentation: Kontaktversuche zu kassenzugelassenen Therapeut:innen', 20, y);
    doc.setFont(undefined, 'normal');
    y += 8;
    kontaktversuche.forEach((k, idx) => {
      const dateStr = k.datum ? new Date(k.datum).toLocaleDateString('de-DE') : '';
      const block = `${idx + 1}. ${k.name} ‚Äî ${dateStr} ‚Äî ${k.art} ‚Äî ${k.erg}`;
      const lines = doc.splitTextToSize(block, 170);
      if (y + lines.length * 6 > 280) { // einfache Seitenumbruch-Logik
        doc.addPage();
        y = 20;
      }
      doc.text(lines, 20, y);
      y += lines.length * 6 + 4;
    });
  }

  // Schlussformel
  if (y + 40 > 280) { doc.addPage(); y = 20; }
  y += 10;
  doc.text('Ich bitte um Pr√ºfung meines Antrags und um Mitteilung innerhalb der gesetzlichen Frist.', 20, y);
  y += 12;
  doc.text('Mit freundlichen Gr√º√üen', 20, y);
  y += 18;
  doc.text(name, 20, y);

  // Speichern
  doc.save('antrag_kostenerstattung_psychotherapie.pdf');

  // Popup anzeigen
  const popup = document.getElementById("spendenPopupPsych");
  if (popup) popup.style.display = "flex";
});

// einfache Helferfunktion: text in Zeilen splitten (f√ºr mehrere Zeilen beim Adressblock)
function splitText(text, maxChars) {
  if (!text) return '';
  const parts = [];
  const words = text.split(/\s+/);
  let line = '';
  words.forEach(w => {
    if ((line + ' ' + w).trim().length > maxChars) {
      parts.push(line.trim());
      line = w;
    } else {
      line += ' ' + w;
    }
  });
  if (line) parts.push(line.trim());
  return parts.join('\n');
}

/* Save / Load (localStorage) */
document.getElementById("saveBtn").addEventListener("click", function() {
  const data = {
    name: document.getElementById("name").value,
    adresse: document.getElementById("adresse").value,
    geburt: document.getElementById("geburt").value,
    nummer: document.getElementById("nummer").value,
    kasse: document.getElementById("kasse").value,
    kassenAdresse: document.getElementById("kassenAdresse").value,
    beschwerden_diagnose: document.getElementById("beschwerden_diagnose").value,
    therapeut: document.getElementById("therapeut").value,
    therapeutAdresse: document.getElementById("therapeutAdresse").value,
    approbiert: document.getElementById("approbiert").value,
    kassenzulassung: document.getElementById("kassenzulassung").value,
    verfuegbar: document.getElementById("verfuegbar").value,
    kontaktversuche: collectKontaktversuche()
  };
  localStorage.setItem("antragPsychData", JSON.stringify(data));
  alert("Eingaben wurden gespeichert.");
});

document.getElementById("loadBtn").addEventListener("click", function() {
  const raw = localStorage.getItem("antragPsychData");
  if (!raw) { alert("Keine gespeicherten Eingaben gefunden."); return; }
  const data = JSON.parse(raw);
  document.getElementById("name").value = data.name || "";
  document.getElementById("adresse").value = data.adresse || "";
  document.getElementById("geburt").value = data.geburt || "";
  document.getElementById("nummer").value = data.nummer || "";
  document.getElementById("kasse").value = data.kasse || "";
  document.getElementById("kassenAdresse").value = data.kassenAdresse || "";
  document.getElementById("beschwerden_diagnose").value = data.beschwerden_diagnose || "";
  document.getElementById("therapeut").value = data.therapeut || "";
  document.getElementById("therapeutAdresse").value = data.therapeutAdresse || "";
  document.getElementById("approbiert").value = data.approbiert || "Ja";
  document.getElementById("kassenzulassung").value = data.kassenzulassung || "Nein";
  document.getElementById("verfuegbar").value = data.verfuegbar || "Ja";

  // Kontaktversuche wiederherstellen (wenn vorhanden)
  if (Array.isArray(data.kontaktversuche)) {
    data.kontaktversuche.forEach((k, idx) => {
      if (idx < 10) {
        document.getElementById(`kontakt_name_${idx}`).value = k.name || "";
        document.getElementById(`kontakt_datum_${idx}`).value = k.datum || "";
        document.getElementById(`kontakt_art_${idx}`).value = k.art || "";
        document.getElementById(`kontakt_ergebnis_${idx}`).value = k.erg || "";
      }
    });
  }
  alert("Gespeicherte Eingaben geladen.");
});

/* Popup schlie√üen */
document.getElementById("closePopupBtnPsych").addEventListener("click", function() {
  document.getElementById("spendenPopupPsych").style.display = "none";
});

/* Platzhalter: protokoll-Anzeige f√ºllen (wenn Daten aus anderem Tool vorhanden sind).
   Hier bleibt die Div leer ‚Äî du kannst bei Bedarf die Daten per JS aus deinem Kontaktprotokoll-Tool einf√ºgen.
*/
document.addEventListener("DOMContentLoaded", function() {
  // ensure popup is hidden initially
  const p = document.getElementById("spendenPopupPsych");
  if (p) p.style.display = "none";
});
</script>

</body>
</html>
