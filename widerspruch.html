<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Widerspruch Kostenerstattung ‚Äì PDF Generator</title>
  <meta name="description" content="Erstellen Sie einen professionellen Widerspruch gegen die Ablehnung der Kostenerstattung.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/logo-lotse-fav.png">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <link rel="stylesheet" href="/css/generator.css">
  
  <style>
    /* Zus√§tzliche Styles f√ºr bessere Lesbarkeit und Hilfestellungen */
    .help-block {
      background-color: #f0f7ff;
      border-left: 4px solid #0070f3;
      padding: 12px;
      margin-bottom: 15px;
      border-radius: 4px;
      font-size: 0.95rem;
      color: #333;
    }
    .help-block h4 {
      margin-top: 0;
      color: #0070f3;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .help-block ul {
      margin: 0;
      padding-left: 1.2rem;
    }
    .help-block li {
      margin-bottom: 4px;
    }
    
    /* Checkbox Container Styling */
    .checkbox-wrapper {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 10px;
    }
    .checkbox-label {
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .checkbox-label input {
        margin-right: 10px;
        width: auto; /* Override generator.css width:100% */
    }
  </style>
</head>
<body>

  <header class="site-header">
    <a href="index.html" class="site-logo">Kassen-Lotse</a>
  </header>

  <div class="page-container">
    <h1>Widerspruch: Kostenerstattung</h1>

    <p class="info-box warning">
      <strong>Wichtig:</strong> Ein Widerspruch muss in der Regel <strong>innerhalb eines Monats</strong> nach Erhalt des Ablehnungsbescheids bei der Krankenkasse eingehen. Nutzen Sie dieses Tool, um ein formgerechtes Schreiben zu erstellen.
    </p>

    <form id="widerspruchKostForm">
      
      <fieldset>
        <legend>1. Ihre Daten (Absender)</legend>
        <label for="kpName">Vor- und Nachname:</label>
        <input type="text" id="kpName" required placeholder="Max Mustermann">

        <label for="kpAdresse">Ihre vollst√§ndige Anschrift:</label>
        <textarea id="kpAdresse" rows="3" required placeholder="Musterstra√üe 1&#10;12345 Musterstadt"></textarea>

        <label for="kpVersichertennr">Versichertennummer (steht auf der Karte):</label>
        <input type="text" id="kpVersichertennr" required placeholder="Z.B. A123456789">
      </fieldset>

      <fieldset>
        <legend>2. Krankenkasse (Empf√§nger)</legend>
        <label for="kpKasseName">Name der Krankenkasse:</label>
        <input type="text" id="kpKasseName" required placeholder="Muster Krankenkasse">

        <label for="kpKasseAdresse">Anschrift der Kasse (f√ºr das Fensterkuvert):</label>
        <textarea id="kpKasseAdresse" rows="3" required placeholder="Hauptstra√üe 99&#10;54321 Kassenstadt"></textarea>
      </fieldset>

      <fieldset>
        <legend>3. Bezug zum abgelehnten Bescheid</legend>
        <div class="help-block">
            <p>Diese Daten finden Sie oben rechts auf dem Brief, den Sie erhalten haben.</p>
        </div>
        <label for="kpBescheidDatum">Datum des Ablehnungsbescheids:</label>
        <input type="date" id="kpBescheidDatum" required>

        <label for="kpAktenzeichen">Aktenzeichen / Unser Zeichen (falls angegeben):</label>
        <input type="text" id="kpAktenzeichen" placeholder="Z.B. Az-2023-XY">
      </fieldset>

      <fieldset>
        <legend>4. Die Begr√ºndung (Das Herzst√ºck)</legend>
        
        <div class="help-block">
            <h4>üí° Tipps f√ºr eine gute Begr√ºndung</h4>
            <p>Bei der Kostenerstattung (¬ß 13 Abs. 3 SGB V) geht es meist um "Systemversagen". Argumentieren Sie:</p>
            <ul>
                <li>Dass Sie trotz intensiver Suche keinen Platz bei einem Vertragsbehandlern gefunden haben (Protokoll!).</li>
                <li>Dass die Behandlung <strong>unaufschiebbar</strong> ist (Gefahr der Verschlimmerung).</li>
                <li>Dass die Kasse ihre Leistungspflicht nicht rechtzeitig erf√ºllen konnte.</li>
            </ul>
        </div>

        <label for="kpBegruendung">Ausf√ºhrliche Begr√ºndung:</label>
        <textarea id="kpBegruendung" rows="10" required placeholder="Hiermit begr√ºnde ich meinen Widerspruch wie folgt:

Ich habe mich intensiv um einen Therapieplatz bei einem Vertragspsychotherapeuten bem√ºht. Wie meinem beigef√ºgten Kontaktprotokoll zu entnehmen ist, habe ich √ºber [Anzahl] Therapeuten kontaktiert. In allen F√§llen erhielt ich Absagen oder Wartezeiten von mehr als [Anzahl] Monaten. Eine so lange Wartezeit ist mir aufgrund meiner gesundheitlichen Situation nicht zumutbar.

Es liegt somit ein Systemversagen vor (¬ß 13 Abs. 3 SGB V). Da Sie mir keine rechtzeitige Behandlung im Sachleistungssystem zur Verf√ºgung stellen konnten, bin ich berechtigt, mir die Leistung selbst zu beschaffen."></textarea>
      </fieldset>

      <fieldset>
        <legend>5. Anlagen</legend>
        <p style="font-size:0.9em; color:#666;">Welche Dokumente legen Sie bei? Diese werden unten auf dem Brief aufgelistet.</p>
        <div class="checkbox-wrapper">
          <label class="checkbox-label"><input type="checkbox" name="anlagenKost" value="Kopie des Kontaktprotokolls"> Kopie des Kontaktprotokolls (Therapeutensuche)</label>
          <label class="checkbox-label"><input type="checkbox" name="anlagenKost" value="Dringlichkeitsbescheinigung / PTV11"> Dringlichkeitsbescheinigung / PTV11</label>
          <label class="checkbox-label"><input type="checkbox" name="anlagenKost" value="Konsiliarbericht"> Konsiliarbericht</label>
          <label class="checkbox-label"><input type="checkbox" name="anlagenKost" value="Bescheinigung Privatpraxis"> Bescheinigung der Privatpraxis (Qualifikationsnachweis)</label>
        </div>
        
        <label for="kpAnlageSonstiges">Sonstige Anlagen (Kommagetrennt):</label>
        <input type="text" id="kpAnlageSonstiges" placeholder="Z.B. √Ñrztliches Attest Hausarzt">
      </fieldset>

      <div class="button-group">
        <button type="button" id="saveBtnKost" class="action-button" style="background-color:#6c757d;">Zwischenspeichern</button>
        <button type="button" id="loadBtnKost" class="action-button" style="background-color:#6c757d;">Laden</button>
        <button type="submit" class="action-button">üìÑ PDF Widerspruch erstellen</button>
      </div>
    </form>
  </div>

  <div id="spendenPopupKost" class="popup-overlay" style="display:none;">
    <div class="popup-content">
      <h2>Viel Erfolg! üçÄ</h2>
      <p>Dein PDF wurde erstellt. Wir dr√ºcken die Daumen f√ºr den Widerspruch!</p>
      <p style="font-size:0.9em;">Kassen-Lotse ist ein kostenloses Projekt. Wenn es dir Zeit gespart hat, freuen wir uns √ºber einen Kaffee.</p>
      <form action="https://www.paypal.com/donate" method="post" target="_blank">
        <input type="hidden" name="business" value="info@kassen-lotse.de" />
        <input type="hidden" name="currency_code" value="EUR" />
        <input type="hidden" name="item_name" value="Kassen-Lotse Support" />
        <button type="submit" class="action-button" style="background-color:#ffc107; color:#000; border:none; margin-top:10px;">Spenden via PayPal</button>
      </form>
      <button id="closePopupBtnKost" class="popup-close-button">Schlie√üen</button>
    </div>
  </div>

  <footer>
    <div class="mini-footer-hint">
      <p>Brauchen Sie mehr Unterst√ºtzung bei Antr√§gen?</p>
      <a href="https://clerion.de" class="mini-footer-link">Clerion - Ihr digitaler Beh√∂rden-Assistent</a>
    </div>
    <p>&copy; 2025 Kassen-Lotse | <a href="index.html">Startseite</a> | <a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Datenschutz</a></p>
  </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- PDF LOGIK ---
    document.getElementById("widerspruchKostForm").addEventListener("submit", function(e) {
        e.preventDefault();
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: "mm", format: "a4" });

        // Variablen holen
        const name = document.getElementById("kpName").value;
        const adresse = document.getElementById("kpAdresse").value;
        const versichertennr = document.getElementById("kpVersichertennr").value;
        const kasseName = document.getElementById("kpKasseName").value;
        const kasseAdresse = document.getElementById("kpKasseAdresse").value;
        const bescheidDatumInput = document.getElementById("kpBescheidDatum").value;
        const aktenzeichen = document.getElementById("kpAktenzeichen").value;
        const begruendung = document.getElementById("kpBegruendung").value;
        const sonstigeAnlagen = document.getElementById("kpAnlageSonstiges").value;

        // Datumsformatierung
        const heute = new Date().toLocaleDateString("de-DE");
        const bescheidDatum = bescheidDatumInput ? new Date(bescheidDatumInput).toLocaleDateString("de-DE") : "unbekannt";

        // Layout-Konstanten
        const leftMargin = 25;
        const rightMargin = 20;
        const contentWidth = 210 - leftMargin - rightMargin;
        let currentY = 20;

        // Schriftart
        doc.setFont('Helvetica');

        // 1. Kleiner Absender √ºber dem Adressfeld (f√ºr Fensterbriefumschlag)
        doc.setFontSize(7);
        doc.setTextColor(80);
        // Adresse einzeilig machen f√ºr die kleine Zeile
        const absenderEinzeilig = (name + ", " + adresse).replace(/\n/g, ", ");
        doc.text(absenderEinzeilig, leftMargin, 45);
        
        // 2. Empf√§ngerfeld (Position f√ºr DIN 5008 Form A/B)
        doc.setFontSize(11);
        doc.setTextColor(0);
        doc.text(kasseName, leftMargin, 50);
        
        // Adresse splitten f√ºr Zeilenumbruch
        const kasseAdresseLines = doc.splitTextToSize(kasseAdresse, 85);
        doc.text(kasseAdresseLines, leftMargin, 55);

        // 3. Datum und Absenderblock rechts
        doc.text(heute, 210 - rightMargin, 50, { align: "right" });
        
        // Block rechts mit Absenderdetails
        let senderY = 60;
        doc.setFontSize(10);
        doc.text("Von:", 210 - rightMargin - 40, senderY);
        doc.text(name, 210 - rightMargin, senderY, { align: "right" });
        senderY += 5;
        
        const adresseLines = doc.splitTextToSize(adresse, 50);
        doc.text(adresseLines, 210 - rightMargin, senderY, { align: "right" });
        senderY += (adresseLines.length * 5) + 2;

        doc.text("Versichertennummer:", 210 - rightMargin - 40, senderY);
        doc.text(versichertennr, 210 - rightMargin, senderY + 5, { align: "right" });

        // 4. Betreff (Fett)
        currentY = 100; // Standardposition nach DIN
        doc.setFont(undefined, 'bold');
        doc.setFontSize(12);
        let betreff = `Widerspruch gegen Ihren Bescheid vom ${bescheidDatum}`;
        if(aktenzeichen) {
            betreff += `\nIhr Zeichen / Aktenzeichen: ${aktenzeichen}`;
        }
        doc.text(betreff, leftMargin, currentY);
        
        // H√∂he anpassen je nach Betreffl√§nge
        currentY += (aktenzeichen ? 15 : 10);

        // 5. Anrede und Einleitung
        doc.setFont(undefined, 'normal');
        doc.setFontSize(11);
        doc.text("Sehr geehrte Damen und Herren,", leftMargin, currentY);
        currentY += 10;

        const einleitung = `hiermit lege ich fristgerecht Widerspruch gegen den oben genannten Bescheid ein, mit dem Sie meinen Antrag auf Kostenerstattung abgelehnt haben.`;
        const einleitungLines = doc.splitTextToSize(einleitung, contentWidth);
        doc.text(einleitungLines, leftMargin, currentY);
        currentY += (einleitungLines.length * 6) + 6;

        // 6. Begr√ºndung
        doc.setFont(undefined, 'bold');
        doc.text("Begr√ºndung:", leftMargin, currentY);
        doc.setFont(undefined, 'normal');
        currentY += 6;

        const begruendungLines = doc.splitTextToSize(begruendung, contentWidth);
        
        // Check auf Seitenumbruch f√ºr Begr√ºndung
        if (currentY + (begruendungLines.length * 6) > 270) {
            // Wenn es nicht passt, Text aufteilen oder neue Seite (einfacher: neue Seite wenn zu voll)
            // Hier simple Logik:
            doc.text(begruendungLines, leftMargin, currentY);
            // Hinweis: In einer perfekten Welt w√ºrde man hier Zeile f√ºr Zeile pr√ºfen
            // Da jsPDF splitTextToSize Array liefert, k√∂nnte man iterieren.
            // F√ºr dieses Snippet lassen wir es "flie√üen" und hoffen, dass es passt oder user nicht 5 Seiten schreibt.
            // Bessere L√∂sung f√ºr lange Texte:
            let lineY = currentY;
            begruendungLines.forEach(line => {
                if (lineY > 280) {
                    doc.addPage();
                    lineY = 20;
                }
                doc.text(line, leftMargin, lineY);
                lineY += 6;
            });
            currentY = lineY;
        } else {
            doc.text(begruendungLines, leftMargin, currentY);
            currentY += (begruendungLines.length * 6);
        }

        // 7. Forderung / Abschluss
        currentY += 10;
        // Page break check
        if (currentY > 250) { doc.addPage(); currentY = 20; }
        
        const abschluss = "Ich bitte Sie daher, Ihre Entscheidung zu √ºberpr√ºfen und die beantragten Kosten zu √ºbernehmen. Sollten Sie an Ihrer Auffassung festhalten, bitte ich um einen rechtsmittelf√§higen Widerspruchsbescheid.";
        const abschlussLines = doc.splitTextToSize(abschluss, contentWidth);
        doc.text(abschlussLines, leftMargin, currentY);
        currentY += (abschlussLines.length * 6) + 10;

        // 8. Gru√üformel
        if (currentY > 260) { doc.addPage(); currentY = 20; }
        doc.text("Mit freundlichen Gr√º√üen", leftMargin, currentY);
        currentY += 15; // Platz f√ºr Unterschrift
        doc.text(name, leftMargin, currentY);
        currentY += 10;

        // 9. Anlagen auflisten
        const checkedAnlagen = Array.from(document.querySelectorAll('input[name="anlagenKost"]:checked')).map(cb => cb.value);
        if (sonstigeAnlagen) {
            checkedAnlagen.push(sonstigeAnlagen);
        }

        if (checkedAnlagen.length > 0) {
            if (currentY > 250) { doc.addPage(); currentY = 20; }
            doc.setFont(undefined, 'bold');
            doc.setFontSize(10);
            doc.text("Anlagen:", leftMargin, currentY);
            doc.setFont(undefined, 'normal');
            currentY += 5;
            
            checkedAnlagen.forEach(anlage => {
                doc.text("- " + anlage, leftMargin, currentY);
                currentY += 5;
            });
        }

        // Speichern
        doc.save("Widerspruch_Kostenerstattung.pdf");

        // Popup zeigen
        document.getElementById("spendenPopupKost").style.display = "flex";
    });

    // --- SPEICHERN & LADEN (LocalStorage) ---
    const storageKey = "widerspruchKostData";

    document.getElementById("saveBtnKost").addEventListener("click", function() {
        const data = {
            kpName: document.getElementById("kpName").value,
            kpAdresse: document.getElementById("kpAdresse").value,
            kpVersichertennr: document.getElementById("kpVersichertennr").value,
            kpKasseName: document.getElementById("kpKasseName").value,
            kpKasseAdresse: document.getElementById("kpKasseAdresse").value,
            kpBescheidDatum: document.getElementById("kpBescheidDatum").value,
            kpAktenzeichen: document.getElementById("kpAktenzeichen").value,
            kpBegruendung: document.getElementById("kpBegruendung").value,
            kpAnlageSonstiges: document.getElementById("kpAnlageSonstiges").value
        };
        localStorage.setItem(storageKey, JSON.stringify(data));
        alert("Daten wurden im Browser gespeichert.");
    });

    document.getElementById("loadBtnKost").addEventListener("click", function() {
        const saved = localStorage.getItem(storageKey);
        if(saved) {
            const data = JSON.parse(saved);
            document.getElementById("kpName").value = data.kpName || "";
            document.getElementById("kpAdresse").value = data.kpAdresse || "";
            document.getElementById("kpVersichertennr").value = data.kpVersichertennr || "";
            document.getElementById("kpKasseName").value = data.kpKasseName || "";
            document.getElementById("kpKasseAdresse").value = data.kpKasseAdresse || "";
            document.getElementById("kpBescheidDatum").value = data.kpBescheidDatum || "";
            document.getElementById("kpAktenzeichen").value = data.kpAktenzeichen || "";
            document.getElementById("kpBegruendung").value = data.kpBegruendung || "";
            document.getElementById("kpAnlageSonstiges").value = data.kpAnlageSonstiges || "";
            alert("Daten geladen.");
        } else {
            alert("Keine gespeicherten Daten gefunden.");
        }
    });

    // Popup Schlie√üen
    document.getElementById("closePopupBtnKost").addEventListener("click", function() {
        document.getElementById("spendenPopupKost").style.display = "none";
    });
});
</script>

</body>
</html>