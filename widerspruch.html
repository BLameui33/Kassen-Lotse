<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Widerspruch Kostenerstattung ‚Äì PDF erstellen</title>
  <meta name="description" content="Erstellen Sie Ihren Widerspruch gegen einen abgelehnten Antrag auf Kostenerstattung (z. B. Psychotherapie).">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/logo-lotse-fav.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Optional: eigenes Script, falls du separate Logik m√∂chtest -->
  <script defer src="kostenerstattung_widerspruch_script.js"></script>
  <link rel="stylesheet" href="/css/generator.css">
</head>
<body>

  <header class="site-header">
    <a href="index.html" class="site-logo">Kassen-Lotse</a>
  </header>

  <div class="page-container">
    <h1>Widerspruch im Kostenerstattungsverfahren</h1>

    <p class="info-box warning">
      Wurde Ihr Antrag auf Kostenerstattung abgelehnt? Hier k√∂nnen Sie einen Widerspruch erstellen.
      Beachten Sie die Widerspruchsfrist! Lesen Sie auch unsere <a href="info-kostenerstattung.html">Informationen zur Kostenerstattung</a>.
    </p>

    <p class="info-box" style="background-color: #fff8e1; border-left: 4px solid #ff9800; padding: 10px; margin-top: 10px;">
      <strong>Hinweis:</strong> Dieses Tool ersetzt keine Rechtsberatung. Es dient der allgemeinen Unterst√ºtzung bei der Antragstellung.
    </p>

    <p class="highlight-box" style="background-color: #fff3f3; border-left: 4px solid #e53935; padding: 10px; margin-top: 10px;">
      <strong>Technischer Hinweis:</strong> Um das PDF erfolgreich herunterzuladen, √∂ffnen Sie diese Seite bitte in einem Internet-Browser wie <strong>Chrome, Firefox oder Safari</strong>. In der Google-App funktioniert der Download nicht zuverl√§ssig.
    </p>

    <form id="widerspruchKostForm">
      <fieldset>
        <legend>1. Angaben zur Person</legend>
        <label for="kpName">Vor- und Nachname</label>
        <input type="text" id="kpName" required>

        <label for="kpAdresse">Vollst√§ndige Adresse</label>
        <textarea id="kpAdresse" rows="3" required></textarea>

        <label for="kpVersichertennr">Versichertennummer</label>
        <input type="text" id="kpVersichertennr" required>
      </fieldset>

      <fieldset>
        <legend>2. Angaben zur Krankenkasse / Empf√§nger</legend>
        <label for="kpKasseName">Name der Krankenkasse</label>
        <input type="text" id="kpKasseName" required>

        <label for="kpKasseAdresse">Vollst√§ndige Adresse der Krankenkasse</label>
        <textarea id="kpKasseAdresse" rows="3" required></textarea>
      </fieldset>

      <fieldset>
        <legend>3. Bescheid / Ablehnung</legend>
        <label for="kpBescheidDatum">Datum des Ablehnungsbescheids</label>
        <input type="date" id="kpBescheidDatum" required>

        <label for="kpAktenzeichen">Aktenzeichen (falls vorhanden)</label>
        <input type="text" id="kpAktenzeichen">

        <label for="kpAblehnungsgrund">Kurze Zusammenfassung des Ablehnungsgrundes</label>
        <textarea id="kpAblehnungsgrund" rows="3" placeholder="z. B. Ablehnung wegen fehlender Wirtschaftlichkeit, keine Kassenzulassung des Therapeuten etc."></textarea>
      </fieldset>

      <fieldset>
        <legend>4. Begr√ºndung Ihres Widerspruchs</legend>
        <p class="info-box">Erl√§utern Sie hier, warum die Ablehnung nicht gerechtfertigt ist. F√ºgen Sie relevante Fakten, Arzt-/Therapeuten-Nachweise oder Gr√ºnde f√ºr Dringlichkeit hinzu.</p>

        <label for="kpBegruendung">Ihre ausf√ºhrliche Begr√ºndung</label>
        <textarea id="kpBegruendung" rows="6" required placeholder="z. B. Keine zumutbaren Therapiepl√§tze, medizinische Dringlichkeit, Nachweise √ºber Kontaktversuche etc."></textarea>
      </fieldset>

      <fieldset>
        <legend>5. Ziel des Widerspruchs</legend>
        <label for="kpForderung">Was m√∂chten Sie erreichen?</label>
        <textarea id="kpForderung" rows="3" required placeholder="z. B. √úbernahme der Therapiekosten ab Datum X."></textarea>
      </fieldset>

      <fieldset>
        <legend>6. Anlagen (optional)</legend>
        <div class="checkbox-group">
          <label><input type="checkbox" name="anlagenKost" value="Kopie Bescheid"> Kopie des angefochtenen Bescheids</label>
          <label><input type="checkbox" name="anlagenKost" value="Arztbericht"> Arztbericht / Befund</label>
          <label><input type="checkbox" name="anlagenKost" value="Nachweise Kontaktversuche"> Nachweise √ºber Kontaktversuche zu Therapeuten</label>
          <label><input type="checkbox" name="anlagenKost" value="Sonstige Belege"> Sonstige Belege</label>
        </div>
        <label for="kpAnlageSonstiges">Sonstige Anlagen (bitte auflisten)</label>
        <input type="text" id="kpAnlageSonstiges">
      </fieldset>

      <div class="button-group">
        <button type="button" id="saveBtnKost" class="button-secondary">Eingaben speichern</button>
        <button type="button" id="loadBtnKost" class="button-secondary">Gespeicherte Eingaben laden</button>
        <button type="submit" class="button-danger">üìÑ Widerspruchs-PDF erstellen</button>
      </div>
    </form>
  </div>

  <!-- Spenden-Popup (angepasst an das Naming der Referenzseite) -->
  <div id="spendenPopupKost" class="popup-overlay">
    <div class="popup-content">
      <h2>Danke f√ºr deine Nutzung üíõ</h2>
      <p>Wenn dir dieses Tool geholfen hat, unterst√ºtze das Projekt gerne mit einer kleinen Spende:</p>
      <form action="https://www.paypal.com/donate" method="post" target="_blank">
        <input type="hidden" name="business" value="info@kassen-lotse.de" />
        <input type="hidden" name="charset" value="utf-8">
        <input type="hidden" name="item_name" value="Unterst√ºtzung f√ºr das Projekt Helfer Antr√§ge & Widerspr√ºche" />
        <input type="hidden" name="currency_code" value="EUR" />
        <input type="submit" value="Spenden mit PayPal" />
      </form>
      <button id="closePopupBtnKost" class="popup-close-button">Schlie√üen</button>
    </div>
  </div>

  <footer>
    <div class="mini-footer-hint">
      <p>Brauchen Sie mehr Unterst√ºtzung bei Antr√§gen, Beh√∂rdenbriefen oder komplexen Schreiben?</p>
      <a href="https://clerion.de" class="mini-footer-link">Clerion - Ihr digitaler Beh√∂rden-Assistent</a>
    </div>
    <p>&copy; 2025 Kassen-Lotse | <a href="index.html">Zur√ºck zur Startseite</a> | <a href="info-kostenerstattung.html">Infos Kostenerstattung</a> | <a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Datenschutz</a></p>
  </footer>

<script>
/* Inline-PDF-Generator (angepasst an die Feld-IDs dieser Seite) */
document.getElementById("widerspruchKostForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "mm", format: "a4" });

  // Formulardaten
  const name = document.getElementById("kpName").value;
  const adresse = document.getElementById("kpAdresse").value;
  const versichertennr = document.getElementById("kpVersichertennr").value;
  const kasseName = document.getElementById("kpKasseName").value;
  const kasseAdresse = document.getElementById("kpKasseAdresse").value;
  const bescheiddatumInput = document.getElementById("kpBescheidDatum").value;
  const aktenzeichen = document.getElementById("kpAktenzeichen").value;
  const ablehnungsgrund = document.getElementById("kpAblehnungsgrund").value;
  const begruendung = document.getElementById("kpBegruendung").value;
  const forderung = document.getElementById("kpForderung").value;

  const absender = `${name}\n${adresse}`;
  const empfaenger = `An:\n${kasseName}\n${kasseAdresse}`;
  const heutigesDatum = new Date().toLocaleDateString("de-DE");
  const bescheiddatum = bescheiddatumInput ? new Date(bescheiddatumInput).toLocaleDateString("de-DE") : "";

  doc.setFont('Helvetica');
  doc.setFontSize(12);

  // Absender & Datum
  doc.setFontSize(10);
  doc.text(absender, 20, 20);
  doc.setFontSize(12);
  doc.text(heutigesDatum, 190, 35, { align: 'right' });

  // Empf√§nger
  doc.text(empfaenger, 20, 50);

  // Betreff
  doc.setFont(undefined, 'bold');
  doc.text(`Widerspruch gegen Ihren Bescheid vom ${bescheiddatum}`, 20, 85);
  doc.setFont(undefined, 'normal');

  // Versichertennummer & Aktenzeichen
  if (versichertennr) {
    doc.text(`Versichertennummer: ${versichertennr}`, 20, 92);
  }
  if (aktenzeichen) {
    doc.text(`Aktenzeichen: ${aktenzeichen}`, 20, 99);
  }

  // Einleitende Anrede
  let currentY = 110;
  doc.text('Sehr geehrte Damen und Herren,', 20, currentY);
  currentY += 8;

  // Haupttext (kombiniert aus Feldern)
  const intro = `hiermit lege ich fristgerecht Widerspruch gegen Ihren Bescheid vom ${bescheiddatum} ein.`;
  const reason = ablehnungsgrund ? `\n\nAblehnungsgrund laut Bescheid:\n${ablehnungsgrund}` : '';
  const claimText = `\n\nBegr√ºndung meines Widerspruchs:\n${begruendung}`;
  const demandText = `\n\nMein Antrag / mein Ziel:\n${forderung}`;

  const haupttext = `${intro}${reason}${claimText}${demandText}\n\nIch bitte um erneute Pr√ºfung und um Mitteilung innerhalb der gesetzlichen Frist.`;
  const textLines = doc.splitTextToSize(haupttext, 170);
  doc.text(textLines, 20, currentY);
  currentY += textLines.length * 7;

  // Gru√üformel und Name
  currentY += 12;
  doc.text('Mit freundlichen Gr√º√üen', 20, currentY);
  currentY += 20;
  doc.text(name, 20, currentY);

  // PDF speichern
  doc.save("widerspruch_kostenerstattung.pdf");

  // Spenden-Popup anzeigen (wie auf Referenzseite)
  const popup = document.getElementById("spendenPopupKost");
  if (popup) popup.style.display = "flex";
});

// Save / Load (localStorage) ‚Äî einfache Umsetzung analog zur Referenzseite
document.getElementById("saveBtnKost").addEventListener("click", function() {
  const data = {
    kpName: document.getElementById("kpName").value,
    kpAdresse: document.getElementById("kpAdresse").value,
    kpVersichertennr: document.getElementById("kpVersichertennr").value,
    kpKasseName: document.getElementById("kpKasseName").value,
    kpKasseAdresse: document.getElementById("kpKasseAdresse").value,
    kpBescheidDatum: document.getElementById("kpBescheidDatum").value,
    kpAktenzeichen: document.getElementById("kpAktenzeichen").value,
    kpAblehnungsgrund: document.getElementById("kpAblehnungsgrund").value,
    kpBegruendung: document.getElementById("kpBegruendung").value,
    kpForderung: document.getElementById("kpForderung").value,
    kpAnlageSonstiges: document.getElementById("kpAnlageSonstiges").value
  };
  localStorage.setItem("widerspruchKostData", JSON.stringify(data));
  alert("Eingaben wurden gespeichert.");
});

document.getElementById("loadBtnKost").addEventListener("click", function() {
  const raw = localStorage.getItem("widerspruchKostData");
  if (!raw) { alert("Keine gespeicherten Eingaben gefunden."); return; }
  const data = JSON.parse(raw);
  document.getElementById("kpName").value = data.kpName || "";
  document.getElementById("kpAdresse").value = data.kpAdresse || "";
  document.getElementById("kpVersichertennr").value = data.kpVersichertennr || "";
  document.getElementById("kpKasseName").value = data.kpKasseName || "";
  document.getElementById("kpKasseAdresse").value = data.kpKasseAdresse || "";
  document.getElementById("kpBescheidDatum").value = data.kpBescheidDatum || "";
  document.getElementById("kpAktenzeichen").value = data.kpAktenzeichen || "";
  document.getElementById("kpAblehnungsgrund").value = data.kpAblehnungsgrund || "";
  document.getElementById("kpBegruendung").value = data.kpBegruendung || "";
  document.getElementById("kpForderung").value = data.kpForderung || "";
  document.getElementById("kpAnlageSonstiges").value = data.kpAnlageSonstiges || "";
  alert("Gespeicherte Eingaben geladen.");
});

// Popup schlie√üen
document.getElementById("closePopupBtnKost").addEventListener("click", function() {
  document.getElementById("spendenPopupKost").style.display = "none";
});

// Stelle sicher, dass Popup-Overlay als flex angezeigt wird (Referenzseite nutzt inline style)
// Falls generator.css bereits .popup-overlay regelt, diese Zeile ist optional:
document.addEventListener("DOMContentLoaded", function() {
  const pop = document.getElementById("spendenPopupKost");
  if (pop) pop.style.display = "none";
});
</script>

</body>
</html>
